"use strict";var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var a=require("typescript");var d=require("stream");var fs=require("fs");var m=require("chalk");var n=require("path");var o=require("chokidar");var File=require("vinyl");var _=require("lodash");var p=require("glob");var q={none:0,error:1,warn:2,trace:3,info:4};var r=(function(){function r(){}r.f=function(a){this.b=a;};r.g=function(a){this.c=a;};r.h=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}console.log.apply(console,[m.gray("["+this.c+"]")].concat(d));};r.j=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<q.info){return;}console.log.apply(console,[m.gray(("["+this.c+"]")+m.blue(" INFO: "))].concat(d));};r.k=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<q.warn){return;}console.log.apply(console,[("["+this.c+"]")+m.yellow(" WARNING: ")].concat(d));};r.l=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<q.error){return;}console.log.apply(console,[("["+this.c+"]")+m.red(" ERROR: ")].concat(d));};r.o=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<q.error){return;}console.log.apply(console,[("["+this.c+"]")+m.gray(" TRACE: ")].concat(d));};r.b=q.none;r.c="logger";return r;}());var TsCore;(function(TsCore){function b(d,e){var f=d.length;var g=e.length;return f>g&&d.substr(f-g,g)===e;}TsCore.b=b;TsCore.c=[".ts",".tsx",".d.ts"];TsCore.d=TsCore.c;function f(a){if(!a){return false;}for(var _i=0,c_1=TsCore.c;_i<c_1.length;_i++){var d=c_1[_i];if(b(a,d)){return true;}}return false;}TsCore.f=f;function g(b){if(b.kind===a.SyntaxKind.ImportDeclaration){return b.moduleSpecifier;}if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var c=b.moduleReference;if(c.kind===a.SyntaxKind.ExternalModuleReference){return c.expression;}}if(b.kind===a.SyntaxKind.ExportDeclaration){return b.moduleSpecifier;}}TsCore.g=g;function i(b){var c=[];for(var _i=1;_i<arguments.length;_i++){c[_i-1]=arguments[_i];}var d=b.message;if(arguments.length>1){d=l(d,arguments,1);}return {file:undefined,start:undefined,length:undefined,messageText:d,category:b.category,code:b.code};}TsCore.i=i;function l(a,b,c){c=c||0;return a.replace(/{(\d+)}/g,function(a,d){return b[+d+c];});}function m(b){return (b.flags&a.NodeFlags.DeclarationFile)!==0;}TsCore.m=m;function p(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration||b.kind===a.SyntaxKind.ImportClause&&!!b.name||b.kind===a.SyntaxKind.NamespaceImport||b.kind===a.SyntaxKind.ImportSpecifier||b.kind===a.SyntaxKind.ExportSpecifier||b.kind===a.SyntaxKind.ExportAssignment&&b.expression.kind===a.SyntaxKind.Identifier;}TsCore.p=p;function q(b){return b.replace(/\\/g,"/");}TsCore.q=q;function s(a){return a.replace(/\.ts/,".js");}TsCore.s=s;})(TsCore||(TsCore={}));var Utils;(function(Utils){function b(c,d){if(c){for(var i=0,k=c.length;i<k;i++){var l=d(c[i],i);if(l){return l;}}}return undefined;}Utils.b=b;function c(a,b){if(a){for(var _i=0,a_1=a;_i<a_1.length;_i++){var v=a_1[_i];if(v===b){return true;}}}return false;}Utils.c=c;var d=Object.prototype.hasOwnProperty;function f(c,e){return d.call(c,e);}Utils.f=f;function g(a){var b={};for(var c in a){b[c]=a[c];}return b;}Utils.g=g;function l(a,f){var b;if(a){b=[];for(var _i=0,a_2=a;_i<a_2.length;_i++){var v=a_2[_i];b.push(f(v));}}return b;}Utils.l=l;function p(b,c){var d=1;var g={};for(var h in b){g[h]=b[h];}for(var i in c){if(!f(g,i)){g[i]=c[i];}}return g;}Utils.p=p;function s(b,c,d){return b.substr(0,c)+d+b.substr(c+d.length);}Utils.s=s;})(Utils||(Utils={}));var t=(function(){function t(b,e){this.c=b;this.d=e;}t.prototype.e=function(){return this.d;};t.prototype.g=function(){return this.c;};t.prototype.k=function(){return (this.c===a.ExitStatus.Success);};return t;}());var u=(function(){function u(b){var _this=this;this.b={};this.c={};this.d=0;this.e={};this.g=0;this.h={};this.getSourceFile=this.l;this.fileExists=function(k){k=_this.getCanonicalFileName(k);if(!_this.m(n.dirname(k))){return false;}if(Utils.f(_this.e,k)){return _this.e[k];}_this.g++;return _this.e[k]=_this.j.fileExists(k);};this.i=b;this.j=a.createCompilerHost(this.i);}u.prototype.k=function(){return this.b;};u.prototype.l=function(b,c,d){return this.j.getSourceFile(b,c,d);};u.prototype.writeFile=function(c,d,e,g){this.b[c]=d;};u.prototype.readFile=function(a){if(Utils.f(this.h,a)){return this.h[a];}return this.h[a]=this.j.readFile(a);};u.prototype.getDefaultLibFileName=function(b){return this.j.getDefaultLibFileName(b);};u.prototype.getCurrentDirectory=function(){return this.j.getCurrentDirectory();};u.prototype.getCanonicalFileName=function(b){return this.j.getCanonicalFileName(b);};u.prototype.useCaseSensitiveFileNames=function(){return this.j.useCaseSensitiveFileNames();};u.prototype.getNewLine=function(){return this.j.getNewLine();};u.prototype.m=function(b){if(Utils.f(this.c,b)){return this.c[b];}this.d++;return this.c[b]=a.sys.directoryExists(b);};return u;}());var v=(function(_super){__extends(v,_super);function v(a){_super.call(this,{objectMode:true});}v.prototype._read=function(){};return v;}(d.Readable));var w=(function(){function w(){}w.prototype.a=function(b){r.h(b);};w.prototype.b=function(c,d){r.h(this.g(c+":",25)+m.magenta(this.f(d.toString(),10)));};w.prototype.c=function(a,e){this.b(a,""+e);};w.prototype.d=function(f,g){this.b(f,(g/1000).toFixed(2)+"s");};w.prototype.e=function(a,c){this.b(a,c.toFixed(2)+"%");};w.prototype.f=function(s,a){while(s.length<a){s=" "+s;}return s;};w.prototype.g=function(s,a){while(s.length<a){s=s+" ";}return s;};return w;}());var x=(function(_super){__extends(x,_super);function x(a){_super.call(this,a);}return x;}(File));var BundlePackageType;(function(BundlePackageType){BundlePackageType[BundlePackageType["None"]=0]="None";BundlePackageType[BundlePackageType["Library"]=1]="Library";BundlePackageType[BundlePackageType["Component"]=2]="Component";})(BundlePackageType||(BundlePackageType={}));var y=(function(){function y(a,d){this.c=undefined;this.b=a;this.c=d;}y.prototype.d=function(){return this.b;};y.prototype.e=function(){return this.c;};return y;}());var z=(function(){function z(){}z.prototype.b=function(c,d){var g=[];return {bundles:a(),errors:g};function a(){var b=[];var e=c["bundles"];if(e){r.j(e);for(var h in e){r.j("Bundle Id: ",h,e[h]);var k=e[h];var m;var o=[];var u={};m=n.join(d,h);if(Utils.f(k,"files")){if(k["files"] instanceof Array){o=Utils.l(k["files"],function(s){return n.join(d,s);});r.j("bundle files: ",o);}else{g.push(TsCore.i({code:6063,category:a.DiagnosticCategory.Error,key:"Bundle_0_files_is_not_an_array_6063",message:"Bundle '{0}' files is not an array."},h));}}else{g.push(TsCore.i({code:6062,category:a.DiagnosticCategory.Error,key:"Bundle_0_requires_an_array_of_files_6062",message:"Bundle '{0}' requires an array of files."},h));}if(Utils.f(k,"config")){u=k.config;}u.package=v(u);b.push({name:m,fileNames:o,config:u});}}return b;}function v(b){var c=0;var d=undefined;var e={"none":0,"library":1,"component":2};if(Utils.f(b,"package")){var g=b["package"];if(typeof (g)==="string"){if(Utils.f(e,g.toLowerCase())){c=e[g.toLowerCase()];}}}if(Utils.f(b,"packageNamespace")){var h=b["packageNamespace"];if(typeof (h)==="string"){d=h;}}return new y(c,d);}};return z;}());var A=(function(){function A(b,c,g){this.o=0;this.p=0;this.q=0;this.f=b;this.j=c;this.l=g;this.n=this.j.getCompilerOptions();}A.prototype.s=function(c){this.q=this.o=new Date().getTime();r.h("Compiling project files...");var u=a.getPreEmitDiagnostics(this.j);if(this.n.noEmitOnError&&u.length>0){return new t(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,u);}this.o=new Date().getTime()-this.o;if(!this.n.noEmit){var v=new Date().getTime();var w=this.j.emit();this.p=new Date().getTime()-v;u=u.concat(w.diagnostics);if(w.emitSkipped){return new t(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,u);}var y=this.f.k();for(var z in y){var A=y[z];var B=new x({path:z,contents:new Buffer(A)});this.l.push(B);}}this.q=new Date().getTime()-this.q;if(u.length>0){return new t(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,u);}if(this.n.diagnostics){this.y();}return new t(a.ExitStatus.Success);};A.prototype.y=function(){var l=new w();l.c("Files",this.j.getSourceFiles().length);l.c("Lines",this.z());l.d("Pre-emit time",this.o);l.d("Emit time",this.p);l.d("Compile time",this.q);};A.prototype.z=function(){var _this=this;var a=0;Utils.b(this.j.getSourceFiles(),function(b){if(!TsCore.m(b)){a+=_this.C(b).length;}});return a;};A.prototype.C=function(b){return b.getLineStarts();};return A;}());var B=(function(_super){__extends(B,_super);function B(b,c){var _this=this;_super.call(this,b);this.getSourceFile=function(b,c,d){if(_this.p){var g_1=_this.p.getSourceFile(b);if(g_1&&g_1.fileWatcher){return g_1;}}var e=_super.prototype.l.call(_this,b,c,d);if(e&&_this.i.watch){e.fileWatcher=o.watch(e.fileName);e.fileWatcher.on("change",function(a,b){return _this.s(e,a,b);});}return e;};this.s=c;}B.prototype.w=function(c){this.p=c;};return B;}(u));var C=(function(){function C(){}C.prototype.a=function(b){var g=new p.Glob(b);var c=g.minimatch.set ;if(c.length>1)return true;for(var j=0;j<c[0].length;j++){if(typeof c[0][j]!=='string')return true;}return false;};C.prototype.c=function(a,e){if(a.length===0){return [];}var f=this.d(a,function(a){return p.sync(a,{root:e});});return f;};C.prototype.d=function(c,g){var k=[];_.flatten(c).forEach(function(b){var c;var a;c=_.isString(b)&&b.indexOf("!")===0;if(c){b=b.slice(1);}a=g(b);if(c){return k=_.difference(k,a);}else{return k=_.union(k,a);}});return k;};return C;}());var D=(function(){function D(b,d,e){this.c=b;this.l=d;this.o=e;}D.prototype.p=function(){return this.o;};D.prototype.t=function(){return this.l;};D.prototype.u=function(){return this.c;};D.prototype.v=function(){return (this.c===a.ExitStatus.Success);};return D;}());var E=(function(){function E(d,e){this.l={};this.b=d;this.c=e;this.h=this.c.getCompilerOptions();}E.prototype.p=function(c){var g=this;var h={};var k={};function d(c){c.forEach(function(e){var i=g.v(e);var l=g.x(i);var m=g.b.getCanonicalFileName(l.fileName);r.j("Import symbol file name: ",m);if(!Utils.f(k,m)){k[m]=true;d(g.s(l));}if(!Utils.f(h,m)){r.j("Adding module import dependencies for file: ",m);h[m]=g.s(l);}});}var l=g.s(c);d(l);var m=g.b.getCanonicalFileName(c.fileName);if(!Utils.f(h,m)){r.j("Adding top level import dependencies for file: ",m);h[m]=l;}return h;};E.prototype.s=function(b){var d=[];var e=this;function h(f){a.forEachChild(f,function(f){if(f.kind===a.SyntaxKind.ImportDeclaration||f.kind===a.SyntaxKind.ImportEqualsDeclaration||f.kind===a.SyntaxKind.ExportDeclaration){r.j("Found import declaration");var i=TsCore.g(f);if(i&&i.kind===a.SyntaxKind.StringLiteral){var l=e.c.getTypeChecker().getSymbolAtLocation(i);if(l){r.j("Adding import symbol: ",l.name,b.fileName);d.push(f);}else{r.k("Module symbol not found");}}}else if(f.kind===a.SyntaxKind.ModuleDeclaration&&f.name.kind===a.SyntaxKind.StringLiteral&&(f.flags&a.NodeFlags.Ambient||TsCore.m(b))){var n=f;r.j("Processing ambient module declaration: ",n.name.text);h(f.body);}});};h(b);return d;};E.prototype.t=function(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration&&b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference;};E.prototype.u=function(b){return b.moduleReference.expression;};E.prototype.v=function(b){var d=TsCore.g(b);if(d&&d.kind===a.SyntaxKind.StringLiteral){return this.c.getTypeChecker().getSymbolAtLocation(d);}};E.prototype.w=function(b){return b.getSourceFile();};E.prototype.x=function(b){var c=b.getDeclarations()[0];var d=c.kind===a.SyntaxKind.SourceFile&&!(c.flags&a.NodeFlags.DeclarationFile);var e=c.getSourceFile();return e;};return E;}());var Ast;(function(Ast){(function(ContainerFlags){ContainerFlags[ContainerFlags["None"]=0]="None";ContainerFlags[ContainerFlags["IsContainer"]=1]="IsContainer";ContainerFlags[ContainerFlags["IsBlockScopedContainer"]=2]="IsBlockScopedContainer";ContainerFlags[ContainerFlags["HasLocals"]=4]="HasLocals";ContainerFlags[ContainerFlags["IsContainerWithLocals"]=5]="IsContainerWithLocals";})(Ast.ContainerFlags||(Ast.ContainerFlags={}));var ContainerFlags=Ast.ContainerFlags;function b(c){if(c.kind!==a.SyntaxKind.BinaryExpression){return false;}var d=c;if(d.operatorToken.kind!==a.SyntaxKind.EqualsToken||d.left.kind!==a.SyntaxKind.PropertyAccessExpression){return false;}var e=d.left;if(e.expression.kind===a.SyntaxKind.PropertyAccessExpression){var g=e.expression;if(g.expression.kind===a.SyntaxKind.Identifier&&g.name.text==="prototype"){return true;}}return false;}Ast.b=b;function c(b){if(b){switch(b.kind){case a.SyntaxKind.Constructor:case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.ArrowFunction:case a.SyntaxKind.MethodDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:return true;}}return false;}Ast.c=c;function d(b){if(b&&(b.flags&a.SymbolFlags.Class)){var c=b.valueDeclaration.flags;if(!(c&a.NodeFlags.Export)){return true;}}return false;}Ast.d=d;function e(b){if(b&&b.valueDeclaration){if(b.valueDeclaration.flags&a.NodeFlags.Abstract){return true;}}return false;}Ast.e=e;function g(b,c){var d=[];function j(b,g){var h=b.types;if(h){for(var _i=0,h_1=h;_i<h_1.length;_i++){var k=h_1[_i];var l=g.getTypeAtLocation(k);var m=l.symbol.valueDeclaration;if(m){var o=m.heritageClauses;if(o){for(var _a=0,o_1=o;_a<o_1.length;_a++){var p=o_1[_a];j(p,g);}}}var n=l.getProperties();for(var _b=0,n_1=n;_b<n_1.length;_b++){var q=n_1[_b];if(Ast.t(q)){d.push(q);}}}}}var e=b.heritageClauses;if(e){for(var _i=0,e_1=e;_i<e_1.length;_i++){var f=e_1[_i];j(f,c);}}return d;}Ast.g=g;function h(b,c){var d=[];var e=b.types;var f=c.getTypeAtLocation(e[0]);var i=f.getSymbol();if(i.valueDeclaration){if(i.valueDeclaration.flags&a.NodeFlags.Abstract){var j=f.getProperties();for(var _i=0,j_1=j;_i<j_1.length;_i++){var k=j_1[_i];d.push(k);}}}return d;}Ast.h=h;function i(b){if(!b){return undefined;}var c=b.id;if(c===undefined&&b.valueDeclaration){c=b.valueDeclaration.symbol.id;}return c?c.toString():undefined;}Ast.i=i;function l(b){switch(b.kind){case a.SyntaxKind.ClassExpression:case a.SyntaxKind.ClassDeclaration:case a.SyntaxKind.InterfaceDeclaration:case a.SyntaxKind.EnumDeclaration:case a.SyntaxKind.TypeLiteral:case a.SyntaxKind.ObjectLiteralExpression:return 1;case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.MethodDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.Constructor:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.ArrowFunction:case a.SyntaxKind.ModuleDeclaration:case a.SyntaxKind.SourceFile:case a.SyntaxKind.TypeAliasDeclaration:return 5;case a.SyntaxKind.CatchClause:case a.SyntaxKind.ForStatement:case a.SyntaxKind.ForInStatement:case a.SyntaxKind.ForOfStatement:case a.SyntaxKind.CaseBlock:return 2;case a.SyntaxKind.Block:return c(b.parent)?0:2;}return 0;}Ast.l=l;function m(b){if(b){var c=b.heritageClauses;if(c){for(var _i=0,c_2=c;_i<c_2.length;_i++){var d=c_2[_i];if(d.token===a.SyntaxKind.ImplementsKeyword){return d;}}}}return undefined;}Ast.m=m;function n(b){if(b){var c=b.heritageClauses;if(c){for(var _i=0,c_3=c;_i<c_3.length;_i++){var d=c_3[_i];if(d.token===a.SyntaxKind.ExtendsKeyword){return d;}}}}return undefined;}Ast.n=n;function p(b){return a.SyntaxKind.FirstKeyword<=b&&b<=a.SyntaxKind.LastKeyword;}Ast.p=p;function q(b){return a.SyntaxKind.FirstPunctuation<=b&&b<=a.SyntaxKind.LastPunctuation;}Ast.q=q;function s(b){return a.SyntaxKind.FirstTriviaToken<=b&&b<=a.SyntaxKind.LastTriviaToken;}Ast.s=s;function t(b){var c=b.valueDeclaration;while(c){if(c.flags&a.NodeFlags.ExportContext){return true;}c=c.parent;}return false;}Ast.t=t;function u(b){var c=b.valueDeclaration;while(c){if(c.flags&a.NodeFlags.Ambient){return true;}c=c.parent;}return false;}Ast.u=u;function v(b){if(b&a.SymbolFlags.FunctionScopedVariable){console.log("Symbol flag: FunctionScopedVariable");}if(b&a.SymbolFlags.BlockScopedVariable){console.log("Symbol flag: BlockScopedVariable ");}if(b&a.SymbolFlags.Property){console.log("Symbol flag: Property");}if(b&a.SymbolFlags.EnumMember){console.log("Symbol flag: EnumMember");}if(b&a.SymbolFlags.Function){console.log("Symbol flag: Function");}if(b&a.SymbolFlags.Class){console.log("Symbol flag: Class");}if(b&a.SymbolFlags.Interface){console.log("Symbol flag: Interface");}if(b&a.SymbolFlags.ConstEnum){console.log("Symbol flag: ConstEnum");}if(b&a.SymbolFlags.RegularEnum){console.log("Symbol flag: RegularEnum");}if(b&a.SymbolFlags.ValueModule){console.log("Symbol flag: ValueModule");}if(b&a.SymbolFlags.NamespaceModule){console.log("Symbol flag: NamespaceModule");}if(b&a.SymbolFlags.TypeLiteral){console.log("Symbol flag: TypeLiteral");}if(b&a.SymbolFlags.ObjectLiteral){console.log("Symbol flag: ObjectLiteral");}if(b&a.SymbolFlags.Method){console.log("Symbol flag: Method");}if(b&a.SymbolFlags.Constructor){console.log("Symbol flag: Constructor");}if(b&a.SymbolFlags.GetAccessor){console.log("Symbol flag: GetAccessor");}if(b&a.SymbolFlags.SetAccessor){console.log("Symbol flag: SetAccessor");}if(b&a.SymbolFlags.Signature){console.log("Symbol flag: Signature");}if(b&a.SymbolFlags.TypeParameter){console.log("Symbol flag: TypeParameter");}if(b&a.SymbolFlags.TypeAlias){console.log("Symbol flag: TypeAlias");}if(b&a.SymbolFlags.ExportValue){console.log("Symbol flag: ExportValue");}if(b&a.SymbolFlags.ExportType){console.log("Symbol flag: ExportType");}if(b&a.SymbolFlags.ExportNamespace){console.log("Symbol flag: ExportNamespace");}if(b&a.SymbolFlags.Alias){console.log("Symbol flag: Alias");}if(b&a.SymbolFlags.Instantiated){console.log("Symbol flag: Instantiated");}if(b&a.SymbolFlags.Merged){console.log("Symbol flag: Merged");}if(b&a.SymbolFlags.Transient){console.log("Symbol flag: Transient");}if(b&a.SymbolFlags.Prototype){console.log("Symbol flag: Prototype");}if(b&a.SymbolFlags.SyntheticProperty){console.log("Symbol flag: SyntheticProperty");}if(b&a.SymbolFlags.Optional){console.log("Symbol flag: Optional");}if(b&a.SymbolFlags.ExportStar){console.log("Symbol flag: ExportStar");}}Ast.v=v;function w(b){if(b&a.NodeFlags.Export){console.log("Node flag: Export");}if(b&a.NodeFlags.Ambient){console.log("Node flag: Ambient");}if(b&a.NodeFlags.Public){console.log("Node Flag: Public");}if(b&a.NodeFlags.Private){console.log("Node Flag: Private");}if(b&a.NodeFlags.Static){console.log("Node Flag: Static");}if(b&a.NodeFlags.Abstract){console.log("Node Flag: Abstract");}if(b&a.NodeFlags.Async){console.log("Node Flag: Async");}if(b&a.NodeFlags.Default){console.log("Node Flag: Default");}if(b&a.NodeFlags.MultiLine){console.log("Node Flag: MultiLine");}if(b&a.NodeFlags.Synthetic){console.log("Node Flag: Synthetic");}if(b&a.NodeFlags.DeclarationFile){console.log("Node Flag: DeclarationFile");}if(b&a.NodeFlags.Let){console.log("Node Flag: Let");}if(b&a.NodeFlags.Const){console.log("Node Flag: Const");}if(b&a.NodeFlags.OctalLiteral){console.log("Node Flag: OctalLiteral");}if(b&a.NodeFlags.Namespace){console.log("Node Flag: Namespace");}if(b&a.NodeFlags.ExportContext){console.log("Node Flag: ExportContext");}if(b&a.NodeFlags.ContainsThis){console.log("Node Flag: ContainsThis");}if(b&a.NodeFlags.Modifier){console.log("Node Flag: Modifier");}if(b&a.NodeFlags.AccessibilityModifier){console.log("Node Flag: AccessibilityModifier");}if(b&a.NodeFlags.BlockScoped){console.log("Node Flag: BlockScoped");}}Ast.w=w;})(Ast||(Ast={}));var F=(function(){function F(b,d,e){this.h={};this.m=[];this.p=undefined;this.c=b;this.g=d;this.m=[b];this.h[e.j().toString()]=e;}F.prototype.q=function(){return this.g;};F.prototype.v=function(){return this.g.name;};F.prototype.w=function(){var b=this.g.id;if(b===undefined&&this.g.valueDeclaration){b=this.g.valueDeclaration.symbol.id;}return b?b.toString():undefined;};F.prototype.x=function(){return this.h;};F.prototype.y=function(){return this.m;};F.prototype.z=function(b,c){this.m.push(b);if(!Utils.f(this.h,c.j().toString())){this.h[c.j().toString()]=c;}};F.prototype.A=function(){if((this.g.flags&a.SymbolFlags.Alias)>0){if(this.g.declarations[0].kind===a.SyntaxKind.NamespaceImport){return true;}}return false;};F.prototype.B=function(){if((this.g.flags&a.SymbolFlags.FunctionScopedVariable)>0){var b=this.N();if(b){return true;}}return false;};F.prototype.C=function(){if((this.g.flags&a.SymbolFlags.BlockScopedVariable)>0){var b=this.N();if(b){return ((b.parent.flags&a.NodeFlags.Let)!==0)||((b.parent.flags&a.NodeFlags.Const)!==0);}}return false;};F.prototype.D=function(b){if(this.g.flags&a.SymbolFlags.Function){if(this.g.valueDeclaration.kind===a.SyntaxKind.FunctionDeclaration){var c=this.g.valueDeclaration.flags;if(Ast.t(this.g)||Ast.u(this.g)){return false;}if(!(c&a.NodeFlags.Export)){return true;}if(b){var d=this.g.valueDeclaration;while(d){if(d.flags&a.NodeFlags.Namespace){var e=d.name.text;if(e!==b){return true;}}d=d.parent;}}}}return false;};F.prototype.E=function(){if((this.g.flags&a.SymbolFlags.FunctionScopedVariable)>0){if(this.g.valueDeclaration.kind===a.SyntaxKind.Parameter){return true;}}return false;};F.prototype.K=function(){return Ast.d(this.g);};F.prototype.L=function(){if((this.g.flags&a.SymbolFlags.Method)>0){if(this.g.valueDeclaration===undefined){return false;}var b=this.g.valueDeclaration.flags;if((b&a.NodeFlags.Private)>0){return true;}var c_4=this.g.parent;if(c_4&&Ast.d(c_4)){if(!Ast.e(c_4)){return true;}}}return false;};F.prototype.M=function(){if((this.g.flags&a.SymbolFlags.Property)>0){if(this.g.valueDeclaration===undefined){return false;}var b=this.g.valueDeclaration.flags;if((b&a.NodeFlags.Private)>0){return true;}var c_5=this.g.parent;if(c_5&&Ast.d(c_5)){if(!Ast.e(c_5)){return true;}}}return false;};F.prototype.N=function(){switch(this.c.parent.kind){case a.SyntaxKind.VariableDeclaration:return this.c.parent;case a.SyntaxKind.VariableDeclarationList:r.k("VariableDeclaratioList in getVariableDeclaration() - returning null");break;case a.SyntaxKind.VariableStatement:r.k("VariableStatement in getVariableDeclaration() - returning null");break;}return null;};return F;}());var H=(function(){function H(){}H.c=function(){return this.b++;};H.b=1;return H;}());var G=(function(){function G(b,f,g){this.u=[];this.B=undefined;this.E={};this.I={};this.J={};this.K={};this.L=[];this.M=0;this.d=H.c();this.s=f;if(f&2){this.m=b;this.A=true;this.t=g.P();}else{this.e=this.m=b;this.A=false;this.t=this;this.D=0;}}G.prototype.j=function(){return this.d;};G.prototype.N=function(b){this.u.push(b);};G.prototype.O=function(){return this.u;};G.prototype.P=function(){return this.t;};G.prototype.Q=function(){if(this.A){return this.t.Q();}return this.D++;};G.prototype.R=function(){return this.A?this.m:this.e;};G.prototype.S=function(){if(this.e){switch(this.e.kind){case a.SyntaxKind.ClassDeclaration:return this.e.members;case a.SyntaxKind.EnumDeclaration:return this.e.members;default:r.o("Container::getMembers() unprocessed container kind: ",this.e.kind);}}return undefined;};G.prototype.T=function(){if(this.e&&this.s&4){switch(this.e.kind){case a.SyntaxKind.ModuleDeclaration:return this.e.locals;default:r.k("Container::getLocals() unprocessed container kind: ",this.e.kind);}}return undefined;};G.prototype.U=function(){return this.A;};G.prototype.V=function(){if(this.s&(1|5)){return true;}return false;};G.prototype.W=function(b){if(b.flags&a.SymbolFlags.Class){this.B=b;}};G.prototype.X=function(){return this.B;};G.prototype.Y=function(a){for(var i=0;i<this.u.length;i++){if(a.j()===this.u[i].j())return true;}return false;};return G;}());var I=(function(){function I(){}I.prototype.walk=function(b){this.visitNode(b);};I.prototype.visitNode=function(b){this.walkChildren(b);};I.prototype.walkChildren=function(b){var _this=this;a.forEachChild(b,function(a){return _this.visitNode(a);});};return I;}());var J=(function(){function J(){this.b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_0123456789";}J.prototype.c=function(a){var b=["do","if","in","for","int","let","new","try","var"];var d;while(true){d=this.d(a++);if(b.indexOf(d)>0){continue;}else{return d;}}};J.prototype.d=function(a){var c=a;var e=this.b[c%54];c=Math.floor(c/54);while(c>0){e+=this.b[c%64];c=Math.floor(c/64);}return e;};return J;}());var Debug;(function(Debug){function a(b,d){if(!b){d=d||"Assertion failed";if(typeof Error!=="undefined"){throw new Error(d);}throw d;}}Debug.a=a;})(Debug||(Debug={}));var K=(function(_super){__extends(K,_super);function K(b,c,d){_super.call(this);this.V=[];this.Y={};this.Z={};this.eb=0;this.fb=0;this.u=b;this.y=b.getTypeChecker();this.H=c;this.U=d;this.V=[];this._=new J();}K.prototype.gb=function(c){this.m=c;return this.jb(c);};K.prototype.hb=function(c){this.cb=new Date().getTime();this.ab=c.length;var g="";var k=a.SyntaxKind.Unknown;var l=false;var m;var o=a.createScanner(a.ScriptTarget.ES5,false,a.LanguageVariant.Standard,c);while((m=o.scan())!==a.SyntaxKind.EndOfFileToken){l=false;if(Ast.s(m)){l=true;}if(!l){switch(k){case a.SyntaxKind.FunctionKeyword:if(m===a.SyntaxKind.Identifier){g+=" ";}break;case a.SyntaxKind.BreakKeyword:case a.SyntaxKind.ContinueKeyword:case a.SyntaxKind.ReturnKeyword:case a.SyntaxKind.YieldKeyword:if(m!==a.SyntaxKind.SemicolonToken){g+=" ";}break;case a.SyntaxKind.ElseKeyword:if(m!==a.SyntaxKind.OpenBraceToken){g+=" ";}break;}switch(m){case a.SyntaxKind.CaseKeyword:case a.SyntaxKind.ClassKeyword:case a.SyntaxKind.ConstKeyword:case a.SyntaxKind.DeleteKeyword:case a.SyntaxKind.DoKeyword:case a.SyntaxKind.ExportKeyword:case a.SyntaxKind.GetKeyword:case a.SyntaxKind.ImportKeyword:case a.SyntaxKind.LetKeyword:case a.SyntaxKind.NewKeyword:case a.SyntaxKind.SetKeyword:case a.SyntaxKind.StaticKeyword:case a.SyntaxKind.ThrowKeyword:case a.SyntaxKind.TypeOfKeyword:case a.SyntaxKind.VarKeyword:case a.SyntaxKind.VoidKeyword:g+=o.getTokenText()+" ";break;case a.SyntaxKind.ExtendsKeyword:case a.SyntaxKind.InKeyword:case a.SyntaxKind.InstanceOfKeyword:g+=" "+o.getTokenText()+" ";break;case a.SyntaxKind.PlusToken:case a.SyntaxKind.PlusPlusToken:if((k===a.SyntaxKind.PlusToken)||(k===a.SyntaxKind.PlusPlusToken)){g+=" ";}g+=o.getTokenText();break;case a.SyntaxKind.MinusToken:case a.SyntaxKind.MinusMinusToken:if((k===a.SyntaxKind.MinusToken)||(k===a.SyntaxKind.MinusMinusToken)){g+=" ";}g+=o.getTokenText();break;default:g+=o.getTokenText();break;}}if(!l){k=m;}}this.bb=g.length;this.cb=new Date().getTime()-this.cb;if(this.H.diagnostics)this.yb();return g;};K.prototype.visitNode=function(b){if(this.xb(b)){_super.prototype.visitNode.call(this,b);this.wb();}else{switch(b.kind){case a.SyntaxKind.Identifier:var c=b;var d=this.y.getSymbolAtLocation(c);if(!d){d=this.ib(c);}if(d){var e=Ast.i(d);if(e===undefined){if(d.flags&a.SymbolFlags.Transient){r.o("Ignoring transient symbol: ",d.name);break;}else{e=a.getSymbolId(d).toString();r.o("Generated symbol id for: ",d.name,e);}}if(Utils.f(this.Z,e)){r.j("Identifier already added: ",d.name,e);var g=this.Z[e];this.Z[e].z(c,this.vb());if(!Utils.f(this.vb().I,e)){this.vb().K[e]=g;}}else{var h=new F(c,d,this.vb());r.j("Adding new identifier: ",h.v(),h.w());this.vb().I[e]=h;this.Z[e]=h;var l=d.getName();if(l.length===1){h.p=l;this.vb().K[e]=h;}this.eb++;}}else{r.k("Identifier does not have a symbol: ",c.text);}break;}_super.prototype.visitNode.call(this,b);}};K.prototype.ib=function(c){var d=this.vb().R();if(d.kind===a.SyntaxKind.FunctionExpression){if(Ast.b(d.parent)){var e=d.parent.left.expression.expression;var g=this.y.getSymbolAtLocation(e);if(g&&g.members){if(Utils.f(g.members,c.text)){r.j("Symbol obtained from prototype function: ",c.text);return g.members[c.text];}}}}return undefined;};K.prototype.jb=function(b){this.db=new Date().getTime();this.walk(b);this.kb();this.db=new Date().getTime()-this.db;if(this.H.diagnostics)this.zb();return b;};K.prototype.kb=function(){for(var b in this.Y){var c=this.Y[b];var d=[];var e=[];e=Ast.g(c.R(),this.y);var f=Ast.n(c.R());if(f){d=Ast.h(f,this.y);}var i=e.concat(d);c.L=i;}this.lb(this.$);};K.prototype.lb=function(b){var c=b.X();if(c){var g=this.Y[c.name];if(g){var h=g.S();if(h){this.rb(h,g);}}}this.sb(b);var d=b.S();if(d){this.rb(d,b);}var e=b.T();if(e){this.qb(e,b);}for(var k in b.I){var l=b.I[k];this.mb(l,b);}for(var m in b.J){var n=b.J[m];var o=Ast.i(n);var p=this.Z[o];this.mb(p,b);}var f=b.O();for(var j=0;j<f.length;j++){this.lb(f[j]);}};K.prototype.mb=function(a,c){var _this=this;if(this.nb(a)){var d_1=this.ob(c,a);r.o("Identifier shortened: ",a.v(),d_1);var e=a.x();for(var f in e){var g=e[f];g.E[d_1]=true;}Utils.b(a.y(),function(b){_this.pb(b,d_1);});return;}};K.prototype.nb=function(a){if(a.C()||a.B()||a.K()||a.L()||a.M()||a.D(this.U.package.e())||a.E()||a.A()){r.o("Identifier CAN be shortened: ",a.v());return true;}r.o("Identifier CANNOT be shortened: ",a.v());return false;};K.prototype.ob=function(b,d){if(!d.p){var e=d.v();if(e.length===1){d.p=e;}else{while(true){var g=this._.c(b.Q());Debug.a(g.length<=e.length);if(!Utils.f(b.E,g)){d.p=g;break;}else{r.o("Generated name was excluded: ",g,e);}}this.fb++;}}else{r.o("Identifier already has shortened name: ",d.v(),d.p);}r.j("Identifier shortened name: ",d.v(),d.p);return d.p;};K.prototype.pb=function(b,c){b.text=c;c=" "+c+" ";b.end=b.pos+c.length-1;for(var i=0;i<c.length;i++){this.m.text=Utils.s(this.m.text,b.pos+i,c[i]);}};K.prototype.qb=function(b,c){for(var d in b){var e=b[d];var f=Ast.i(e.declarations[0].symbol);if(f){var g=this.Z[f];this.mb(g,c);}else{r.k("Container local does not have a UId");}}};K.prototype.rb=function(b,c){for(var d in b){var e=b[d];var f=e.symbol;if(f){var g=Ast.i(f);if(g){var h=this.Z[g];var j=false;for(var l in c.L){var m=h.q();var n=c.L[l];if(m.name===n.name){j=true;h.p=h.v();break;}}if(!j){this.mb(h,c);}}else{r.k("Container member does not have a UId");}}else{r.k("Container member does not have a symbol.");}}};K.prototype.sb=function(b){var c=b.X();if(c){var d=this.Y[c.name];if(d){var e=d.S();if(e){for(var f in e){var g=e[f];var h=g.symbol;var j=Ast.i(h);var k=this.Z[j];if(k&&k.p){b.E[k.p]=true;}}}}}for(var l in b.I){var m=b.I[l];this.ub(m,b);}for(var n in b.J){var o=b.J[n];var q=Ast.i(o);var r=this.Z[q];Debug.a(r!==undefined,"Container classifiable identifier symbol not found.");this.ub(r,b);}};K.prototype.tb=function(c){var d=this.H.target;var e={};function g(b){var c=b.O();for(var i=0;i<c.length;i++){var h=c[i];if(h.U()){g(h);}}for(var j in b.K){var k=b.K[j];if((!k.C)||(d===a.ScriptTarget.ES5)){if(!Utils.f(e,k.w())){e[k.w()]=k;}}}}g(c.P());return e;};K.prototype.ub=function(a,b){var c=a.x();for(var d in c){var e=c[d];var f=this.tb(e);for(var g in f){var h=f[g];if(h.p){b.E[h.p]=true;}}}};K.prototype.vb=function(){return this.V[this.V.length-1];};K.prototype.wb=function(){return this.V.pop();};K.prototype.xb=function(b){var c=Ast.l(b);if(c&(1|2)){var d=new G(b,c,this.vb());var e=b.symbol;if(e&&(e.flags&a.SymbolFlags.Class)){var h=Ast.i(e);if(!Utils.f(this.vb().J,h)){this.vb().J[h]=e;}if(!Utils.f(this.Y,e.name)){this.Y[e.name]=d;}var j=Ast.n(b);if(j){var k=this.y.getSymbolAtLocation(j.types[0].expression);d.W(k);}}var g=this.vb();if(!g){this.$=d;}else{g.N(d);}this.V.push(d);return true;}return false;};K.prototype.yb=function(){var a=new w();a.d("Whitespace time",this.cb);a.e("Whitespace reduction",((this.ab-this.bb)/this.ab)*100.00);};K.prototype.zb=function(){var a=new w();a.d("Minify time",this.db);a.c("Total identifiers",this.eb);a.c("Identifiers shortened",this.fb);};return K;}(I));var L=(function(){function L(){}L.c=function(d){if(!d){return;}for(var i=0;i<d.length;i++){this.d(d[i]);}};L.d=function(b){if(!b){return;}var c="";if(b.file){var f=a.getLineAndCharacterOfPosition(b.file,b.start);c+=m.gray(b.file.fileName+"("+(f.line+1)+","+(f.character+1)+"): ");}var e;switch(b.category){case a.DiagnosticCategory.Error:e=m.red(a.DiagnosticCategory[b.category].toLowerCase());break;case a.DiagnosticCategory.Warning:e=m.yellow(a.DiagnosticCategory[b.category].toLowerCase());break;default:e=m.green(a.DiagnosticCategory[b.category].toLowerCase());}c+=e+" TS"+m.white(b.code+'')+": "+m.grey(a.flattenDiagnosticMessageText(b.messageText,"\n"));r.h(c);};return L;}());var M=(function(){function M(l,n,u){this.d=l;this.q(u);this.j=n;}M.prototype.n=function(){this.j.compilerOptions.watch||false;};M.prototype.o=function(){return this.f;};M.prototype.q=function(c){if(this.f){var e_2=c?c.getSourceFiles():undefined;Utils.b(this.f.getSourceFiles(),function(a){if(!(e_2&&Utils.c(e_2,a))){var b=a;if(b.fileWatcher){b.fileWatcher.unwatch(b.fileName);}}});}this.d.w(c);this.f=c;};return M;}());var N=(function(){function N(b,c){this.y=0;this.z=0;this.C=0;this.F=0;this.G="";this.H="";this.I={};this.J={};this.K={};this.u=b;this.x=c;}N.prototype.M=function(w){var _this=this;this.l=w;this.F=new Date().getTime();var B=new E(this.u,this.x);var C=n.dirname(w.name);if(w.config.outDir){C=n.join(C,w.config.outDir);}var P=n.join(C,n.basename(w.name));P=TsCore.q(P);this.G="";this.H="";this.I={};this.J={};this.K={};var Q=false;var R={};for(var W in w.fileNames){var X=w.fileNames[W];r.j(">>> Processing bundle file:",X);var Y=this.u.getCanonicalFileName(TsCore.q(X));r.j("BundleSourceFileName:",Y);var Z=this.x.getSourceFile(Y);if(!Z){var ab=TsCore.i({code:6060,category:a.DiagnosticCategory.Error,key:"Bundle_source_file_0_not_found_6060",message:"Bundle source file '{0}' not found."},Y);return new D(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,[ab]);}if(Z.languageVariant==a.LanguageVariant.JSX){Q=true;}var $=new Date().getTime();var _=B.p(Z);this.y+=new Date().getTime()-$;for(var bb in _){if(!Utils.f(R,bb)){R[bb]=_[bb];}}$=new Date().getTime();r.j("Traversing source dependencies for: ",Z.fileName);for(var cb in _){_[cb].forEach(function(b){var c=_this.Z(b);if(_this.X(c)){var d=c.getDeclarations()[0];var e=d.getSourceFile();var g=e.fileName;if(!Utils.f(_this.I,g)){_this.V(e);}}else{if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var h=b.name.text;var i=_this.P(b);if(_this.Q(i,h)){_this.U(b.getText());}}else{_this.R(b);}}});}this.V(Z);this.z+=new Date().getTime()-$;}var S=this.H;if(w.config.package.d()===1){S+="export namespace "+w.config.package.e()+" {\r\n";S+=this.G;S+=" \r\n}";}else{S+=this.G;}var T=Q?".tsx":".ts";var U={path:P+T,extension:T,text:S};this.F=new Date().getTime()-this.F;if(this.x.getCompilerOptions().diagnostics){this.$();}return new D(a.ExitStatus.Success,undefined,U);};N.prototype.P=function(b){if(b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference){var c=b.moduleReference;return c.expression.text;}else{return b.moduleReference.getText();}};N.prototype.Q=function(a,b){if(!Utils.f(this.J,a)){this.J[a]={};}var c=this.J[a];if(!Utils.f(c,b)){c[b]=b;return true;}return false;};N.prototype.R=function(c){var _this=this;if(!c.importClause){return;}var d=c.moduleSpecifier.text;var e="import ";var f=false;var g=false;if(c.importClause){if(c.importClause.name&&this.Q(d,c.importClause.name.text)){e+=c.importClause.name.text;f=true;}}if(c.importClause.namedBindings){if(c.importClause.namedBindings.kind===a.SyntaxKind.NamespaceImport){if(this.Q(d,c.importClause.namedBindings.name.text)){if(f){e+=", ";}e+="* as ";e+=c.importClause.namedBindings.name.text;g=true;}}else{if(f){e+=", ";}e+="{ ";Utils.b(c.importClause.namedBindings.elements,function(a){if(_this.Q(d,a.name.text)){if(!g){g=true;}else{e+=", ";}var b=a.propertyName;if(b){e+=b.text+" as "+a.name.text;}else{e+=a.name.text;}}});e+=" }";}}e+=" from ";e+=c.moduleSpecifier.getText();e+=";";if(f||g){this.U(e);}};N.prototype.S=function(b){var _this=this;r.j("Processing import statements and export declarations in file: ",b.fileName);var c=b.text;a.forEachChild(b,function(b){if(b.kind===a.SyntaxKind.ImportDeclaration||b.kind===a.SyntaxKind.ImportEqualsDeclaration||b.kind===a.SyntaxKind.ExportDeclaration){r.j("processImportStatements() found import");var f=TsCore.g(b);if(f&&f.kind===a.SyntaxKind.StringLiteral){var h=_this.x.getTypeChecker().getSymbolAtLocation(f);if((h)&&(_this.X(h)||_this.Y)){r.j("processImportStatements() removing code module symbol.");c=_this.T(b.pos,b.end,c);}}}else{if(_this.l.config.package.d()===2){if(b.kind===a.SyntaxKind.ModuleDeclaration){var i_1=b;if(i_1.name.getText()!==_this.l.config.package.e()){if(i_1.flags&a.NodeFlags.Export){r.j("Component namespace not package namespace. Removing export modifier.");var k=i_1.modifiers[0];c=_this.T(k.pos,k.end,c);}}}else{if(b.flags&a.NodeFlags.Export){var m=b.modifiers[0];c=_this.T(m.pos,m.end,c);}}}}});return c;};N.prototype.T=function(a,b,c){var d=b-a;var e="";for(var i=0;i<d;i++){e+=" ";}var f=c.substring(0,a);var g=c.substring(b);return f+e+g;};N.prototype.U=function(a){r.j("Entering emitModuleImportDeclaration()");this.H+=a+"\n";};N.prototype.V=function(b){r.j("Entering addSourceFile() with: ",b.fileName);if(this.W(b)){var c=this.S(b);this.G+=c+"\n";this.I[b.fileName]=b.fileName;}else{if(!Utils.f(this.K,b.fileName)){r.j("Adding definition file to bundle source context: ",b.fileName);this.K[b.fileName]=b.text;}}};N.prototype.W=function(b){return (b.kind===a.SyntaxKind.SourceFile&&!(b.flags&a.NodeFlags.DeclarationFile));};N.prototype.X=function(b){var c=b.getDeclarations()[0];return (c.kind===a.SyntaxKind.SourceFile&&!(c.flags&a.NodeFlags.DeclarationFile));};N.prototype.Y=function(b){var c=b.getDeclarations()[0];return ((c.kind===a.SyntaxKind.ModuleDeclaration)&&((c.flags&a.NodeFlags.Ambient)>0));};N.prototype.Z=function(b){var c=TsCore.g(b);if(c&&c.kind===a.SyntaxKind.StringLiteral){return this.x.getTypeChecker().getSymbolAtLocation(c);}};N.prototype.$=function(){var a=new w();a.d("Deps gen time",this.y);a.d("Deps walk time",this.z);a.d("Source gen time",this.F);};return N;}());var O=(function(){function O(b,c,d){this.C=0;this.E=0;this.F=0;this.G={};this.l=b;this.u=c;this.y=d;this.z=this.u.getCompilerOptions();}O.prototype.H=function(B,J){var _this=this;r.h("Compiling bundle...");this.E=this.F=new Date().getTime();var P;var Q;var R;var S=[];Utils.b(this.u.getSourceFiles(),function(a){S.push(a.fileName);});var T={};var U;var V=J.minify||false;if(V){var ib_1=n.dirname(B.path);var jb_1=n.basename(B.path,B.extension);P=TsCore.q(n.join(ib_1,jb_1+".min.ts"));}else{P=B.path;}Q=B.text;this.G[P]=Q;R=a.createSourceFile(P,B.text,this.z.target);S.push(P);Utils.b(this.u.getSourceFiles(),function(a){_this.G[a.fileName]=a.text;});function i(c,d,e,g){T[c]=d;}function k(c,d,e){if(c===P){return R;}var g=U(c,d,e);return g;}U=this.l.getSourceFile;this.l.getSourceFile=k;this.l.writeFile=i;var W=this.z;W.declaration=J.declaration||this.z.declaration;W.sourceMap=J.sourceMap||this.z.sourceMap;W.noEmit=false;if(V){W.removeComments=true;}var X=a.createProgram(S,W,this.l);var Y=a.getPreEmitDiagnostics(X);this.F=new Date().getTime()-this.F;if(this.z.noEmitOnError&&Y.length>0){return new t(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,Y);}if(V){r.h("Minifying bundle...");var kb=new K(X,W,J);R=kb.gb(R);}this.C=new Date().getTime();var Z=X.emit(R);this.C=new Date().getTime()-this.C;r.j("Streaming vinyl bundle source: ",P);var $=new x({path:P,contents:new Buffer(B.text)});this.y.push($);var _=Y.concat(Z.diagnostics);if(Z.emitSkipped){return new t(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,_);}if(this.z.noEmitOnError&&_.length>0){return new t(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,_);}var ab=n.dirname(B.path);var bb=n.basename(B.path,B.extension);var cb=V?".min":"";var db=TsCore.q(n.join(ab,bb+cb+".js"));if(Utils.f(T,db)){var lb=T[db];if(V){var nb=new K(X,W,J);lb=nb.hb(lb);}r.j("Streaming vinyl js: ",bb);var mb=new x({path:db,contents:new Buffer(lb)});this.y.push(mb);}var eb=TsCore.q(n.join(ab,bb+cb+".d.ts"));if(Utils.f(T,eb)){r.j("Streaming vinyl d.ts: ",eb);var ob=new x({path:eb,contents:new Buffer(T[eb])});this.y.push(ob);}var fb=TsCore.q(n.join(ab,bb+cb+".js.map"));if(Utils.f(T,fb)){r.j("Streaming vinyl js.map: ",fb);var pb=new x({path:fb,contents:new Buffer(T[fb])});this.y.push(pb);}this.E=new Date().getTime()-this.E;if(this.z.diagnostics)this.I();if(_.length>0){return new t(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,_);}else{return new t(a.ExitStatus.Success);}};O.prototype.I=function(){var a=new w();a.d("Pre-emit time",this.F);a.d("Emit time",this.C);a.d("Compile time",this.E);};return O;}());var P=(function(){function P(a,b){var _this=this;this.C=0;this.E=0;this.F=0;this.G=0;this.W=function(a,b){_this.I=undefined;_this.Y();};this.X=function(a,b,c){a.fileWatcher.unwatch(a.fileName);a.fileWatcher=undefined;_this.Y();};this.Z=function(){_this.K=undefined;var a=_this.U();_this.cb(a);if(_this.I.j.compilerOptions.watch){r.h("Watching for project changes...");}};this.l=a;this.u=b;}P.prototype.Q=function(w){var J=this.V();if(!J.success){L.c(J.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.I=this.R(J);r.h("Building Project with: "+m.magenta(""+this.B));r.h("TypeScript compiler version: ",a.version);this.x=w;var S=this.U();this.cb(S);if(J.compilerOptions.watch){r.h("Watching for project changes...");}else{this.T();}return S;};P.prototype.R=function(a){if(a.compilerOptions.watch){if(!this.S()){a.compilerOptions.watch=false;}}var b=new B(a.compilerOptions,this.X);return new M(b,a);};P.prototype.S=function(){var _this=this;if(!a.sys.watchFile){var b=TsCore.i({code:5001,category:a.DiagnosticCategory.Warning,key:"The_current_node_host_does_not_support_the_0_option_5001",message:"The current node host does not support the '{0}' option."},"-watch");L.d(b);return false;}if(!this.J){this.J=o.watch(this.B);this.J.on("change",function(a,b){return _this.W(a,b);});}return true;};P.prototype.T=function(){this.x.push(null);};P.prototype.U=function(){this.C=this.F=new Date().getTime();if(!this.I){var P=this.V();if(!P.success){L.c(P.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.I=this.R(P);}var f=[];var l=this.I.j.fileNames;var n=this.I.j.bundles;var u=this.I.j.compilerOptions;var w=a.createProgram(l,u,this.I.d,this.I.o());this.F=new Date().getTime()-this.F;this.I.q(w);var y=new A(this.I.d,w,this.x);this.E=new Date().getTime();var z=y.s();this.E=new Date().getTime()-this.E;if(!z.k()){L.c(z.e());return z.g();}if(u.listFiles){Utils.b(this.I.o().getSourceFiles(),function(a){r.h(a.fileName);});}this.G=new Date().getTime();var B=new N(this.I.d,this.I.o());var J=new O(this.I.d,this.I.o(),this.x);var K;for(var i=0,Q=n.length;i<Q;i++){r.h("Building bundle: ",m.cyan(n[i].name));K=B.M(n[i]);if(!K.v()){L.c(K.t());return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}z=J.H(K.p(),n[i].config);if(!z.k()){L.c(z.e());return z.g();}}this.G=new Date().getTime()-this.G;this.C=new Date().getTime()-this.C;if(u.diagnostics){this.db();}if(f.length>0){return a.ExitStatus.DiagnosticsPresent_OutputsGenerated;}return a.ExitStatus.Success;};P.prototype.V=function(){var _this=this;try{var q=fs.lstatSync(this.l).isDirectory();}catch(e){var s=TsCore.i({code:6064,category:a.DiagnosticCategory.Error,key:"Cannot_read_project_path_0_6064",message:"Cannot read project path '{0}'."},this.l);return {success:false,errors:[s]};}if(q){this.y=this.l;this.B=n.join(this.l,"tsconfig.json");}else{this.y=n.dirname(this.l);this.B=this.l;}r.j("Reading config file:",this.B);var d=a.readConfigFile(this.B,this.$);if(d.error){return {success:false,errors:[d.error]};}var f=d.config;r.j("Parsing config file...");var g=a.parseJsonConfigFileContent(f,a.sys,this.y);if(g.errors.length>0){return {success:false,errors:g.errors};}g.fileNames=this.ab(g.fileNames,this.y);if(this.u.convertFiles===true){this.bb(g.fileNames,this.y);}var h=new z();var k=h.b(f,this.y);if(k.errors.length>0){return {success:false,errors:k.errors};}k.bundles.forEach(function(a){a.fileNames=_this.ab(a.fileNames,_this.y);});var m=this._(this.u,this.y);if(m.errors.length>0){return {success:false,errors:m.errors};}var o=Utils.p(m.options,g.options);r.j("Compiler options: ",o);return {success:true,compilerOptions:o,fileNames:g.fileNames,bundles:k.bundles};};P.prototype.Y=function(){if(this.K){clearTimeout(this.K);}this.K=setTimeout(this.Z,250);};P.prototype.$=function(b){return a.sys.readFile(b);};P.prototype._=function(b,c){var d=a.parseJsonConfigFileContent(b,a.sys,c);if(d.options.project){var e=TsCore.i({code:5099,category:a.DiagnosticCategory.Error,key:"The_compiler_option_0_is_not_supported_in_this_context_5099",message:"The compiler option '{0}' is not supported in this context."},"--project");d.errors.push(e);}if(d.options.init){var f=TsCore.i({code:5099,category:a.DiagnosticCategory.Error,key:"The_compiler_option_0_is_not_supported_in_this_context_5099",message:"The compiler option '{0}' is not supported in this context."},"--init");d.errors.push(f);}return d;};P.prototype.ab=function(d,e){var f=new C();var g=[];Utils.b(d,function(b){if(!f.a(b)){g.push(n.normalize(b));}});var h=f.c(d,e);var i=[];Utils.b(h,function(a){i.push(n.normalize(a));});return _.union(i,g);};P.prototype.bb=function(a,b){var c="";try{c=fs.readFileSync(this.B,'utf8');if(c!==undefined){var d=JSON.parse(c);var f_1=[];a.forEach(function(a){f_1.push(n.relative(b,a).replace(/\\/g,"/"));});d["files"]=f_1;fs.writeFileSync(this.B,JSON.stringify(d,undefined,4));}}catch(e){r.h(m.yellow("Converting project files failed."));}};P.prototype.cb=function(b){switch(b){case a.ExitStatus.Success:r.h(m.green("Project build completed successfully."));break;case a.ExitStatus.DiagnosticsPresent_OutputsSkipped:r.h(m.red("Build completed with errors."));break;case a.ExitStatus.DiagnosticsPresent_OutputsGenerated:r.h(m.red("Build completed with errors. "+m.italic("Outputs generated.")));break;}};P.prototype.db=function(){var b=new w();b.a("Total build times...");b.d("Pre-build time",this.F);b.d("Compiling time",this.E);b.d("Bundling time",this.G);b.d("Build time",this.C);};return P;}());var TsProject;(function(TsProject){function src(a,b){if(a===undefined&&typeof a!=='string'){throw new Error("Provide a valid directory or file path to the Typescript project configuration json file.");}b=b||{};b.logLevel=b.logLevel||0;r.f(b.logLevel);r.g("TsProject");var c=new v();var e=new P(a,b);e.Q(c);return c;}TsProject.src=src;})(TsProject=exports.TsProject||(exports.TsProject={}));module.exports=TsProject;